<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Photo Location Finder</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    #map { height: 300px; margin-top: 20px; }
    img { max-width: 100%; height: auto; margin-top: 10px; }
  </style>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
</head>
<body>
  <h1>Upload a Photo to Find Location</h1>
  <input type="file" id="fileInput" accept="image/*" />
  <div id="output"></div>
  <div id="map"></div>

  <script src="https://unpkg.com/exif-js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('output');
    let map;

    // Converts EXIF GPS coordinates (DMS) to decimal
    function toDecimal(coord, ref) {
      let degrees = coord[0].numerator / coord[0].denominator;
      let minutes = coord[1].numerator / coord[1].denominator;
      let seconds = coord[2].numerator / coord[2].denominator;

      let dec = degrees + minutes / 60 + seconds / 3600;
      return (ref === 'S' || ref === 'W') ? -dec : dec;
    }

    fileInput.addEventListener('change', (event) => {
      output.innerHTML = '';
      const file = event.target.files[0];
      if (!file) return;

      const img = document.createElement('img');
      img.src = URL.createObjectURL(file);
      output.appendChild(img);

      EXIF.getData(file, function() {
        const lat = EXIF.getTag(this, 'GPSLatitude');
        const lon = EXIF.getTag(this, 'GPSLongitude');
        const latRef = EXIF.getTag(this, 'GPSLatitudeRef');
        const lonRef = EXIF.getTag(this, 'GPSLongitudeRef');

        if (lat && lon && latRef && lonRef) {
          const latitude = toDecimal(lat, latRef);
          const longitude = toDecimal(lon, lonRef);
          output.innerHTML += `<p>Location found: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}</p>`;

          // Show map
          if (map) {
            map.remove();
          }
          map = L.map('map').setView([latitude, longitude], 15);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
          }).addTo(map);
          L.marker([latitude, longitude]).addTo(map).bindPopup('Photo Location').openPopup();
        } else {
          output.innerHTML += '<p>No GPS data found in the photo.</p>';
          if (map) {
            map.remove();
          }
        }
      });
    });
  </script>
</body>
</html>
